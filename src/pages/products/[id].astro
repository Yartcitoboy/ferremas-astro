---
// Importa los componentes necesarios
import MainLayout from "@/layouts/MainLayout.astro";
import { getCollection } from "astro:content";

// Obtén el parámetro dinámico `id` de la URL
const { id } = Astro.params;

// Carga los datos del producto desde la API
const response = await fetch(`http://localhost:8000/product/${id}`, {
  headers: {
    "x-api-key": "miclaveultrasecreta123."
  }
});

if (!response.ok) {
  throw new Error("Error al obtener los datos del producto");
}

export async function getStaticPaths() {
  const productEntries = await getCollection("products", ({ id }) =>
    id.startsWith("en/")
  );
  return productEntries.map((product) => {
    const idWithoutLang = product.id.replace(/^en\//, ""); // Remove the "en/" prefix
    return {
      params: { id: idWithoutLang },
      props: { product },
    };
  });
}

const product = await response.json();
---

<MainLayout title={product.title || "Producto no encontrado"}>
  <div class="mx-auto max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 2xl:max-w-full">
    <div class="mb-4 flex items-center justify-between gap-8 sm:mb-8 md:mb-12">
      <h1 class="text-2xl font-bold tracking-tight text-neutral-800 dark:text-neutral-200 md:text-4xl">
        {product.title || "Producto no encontrado"}
      </h1>
    </div>

    <!-- Imagen principal del producto -->
    {product.main?.imgMain ? (
      <img src={product.main.imgMain} alt={product.main.imgAlt || "Imagen del producto"} class="w-full rounded-lg" />
    ) : (
      <p class="text-neutral-600 dark:text-neutral-400">Imagen no disponible</p>
    )}

    <!-- Descripción del producto -->
    <section class="mt-8">
      <h2 class="text-lg font-semibold text-neutral-800 dark:text-neutral-200">Descripción</h2>
      <p class="mt-4 text-neutral-600 dark:text-neutral-400">{product.main?.content || "Descripción no disponible"}</p>
    </section>

    <!-- Especificaciones -->
    <section class="mt-8">
      <h2 class="text-lg font-semibold text-neutral-800 dark:text-neutral-200">Especificaciones</h2>
      {product.specificationsLeft ? (
        <ul class="mt-4 space-y-2">
          {product.specificationsLeft.map((spec: { title: string; subTitle: string }) => (
            <li>
              <strong>{spec.title}:</strong> {spec.subTitle}
            </li>
          ))}
        </ul>
      ) : (
        <p class="text-neutral-600 dark:text-neutral-400">Especificaciones no disponibles</p>
      )}
    </section>
  </div>
</MainLayout>

---


